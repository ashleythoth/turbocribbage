<html xmlns="http://www.w3.org/1999/html">
  <head>
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/blobs.css">
    <link rel="stylesheet" href="/static/css/cards.css">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    {{ fontawesome_css() }}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ game.name }}</title>
    <script src="/static/js/lib/socketio.min.js"></script>
    <script src="/static/js/lib/jquery.min.js"></script>
    <script src="/static/js/lib/jquery-ui.min.js"></script>
    <script src="/static/js/lib/bootstrap.min.js"></script>
    <script type="module" src="/static/js/app.js"></script>
  </head>
  <body>
      <div class="game row container justify-content-center h-100 bg-gradient-dark text-white">
        <div class="game-play-container col-12">
          <div class="opponents row-fluid d-flex justify-content-center">
              {% for name, points in opponents.items() %}
                <div id="{{ name }}" class="opponent rounded panel panel-default">
                  <div class="panel-heading">
                    <span class="player-nickname">{{ name }}</span>
                    <span class="player-status"></span>
                  </div>
                  <div class="row opponent-play-area panel-body">
                    <div id="{{ name }}-cards" class="player-cards col-12"></div>
                  </div>
                </div>
              {% endfor %}
          </div>
          <button id="leave-game" type="submit" class="btn btn-outline-danger"><i class="fa fa-times"></i></button>


            <div class="middle-area row">
              <!--CHAT LOG-->
              <div class="col-9 game-log-container rounded panel">
                <div class="game-log-header">
                  <span>chat</span>
                </div>
                <div class="game-log"></div>
                <form id="send_message" class="input-group" method="POST" action='#'>
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="fas fa-smile-o"></span>
                    </div>
                    <input type="text" class="form-control" name="message-content" id="message-content" placeholder="message">
                    <div class="input-group-append">
                      <button id="send_message_button" class="btn btn-secondary btn-sm" type="submit">
                        <span class="fas fa-paper-plane"></span>
                      </button>
                    </div>
                  </div>
                </form>
              </div>

              <!--PLAY COUNTER, DECK, CUT CARD-->
              <div class="deck-area col-3">
                <div class="count-container">
                  <div class="count-text">count: </div>
                  <div id="play-total"></div>
                </div>
                <div class="deck-container">
                  <img id="deck" src="/static/img/cards/facedown.png" alt="This the deck">
                </div>
              </div>
              <div class="peg-board col-9 rounded"></div>
            </div>

            <!--player area-->
            <div id="{{ player_name }}" class="player rounded panel panel-default">
              <div class="panel-heading">
                <span class="player-nickname">{{ player_name }}</span>
                <div class="action-button-container">
                  <button id="action-button" type="button" class="btn btn-outline-dark">START</button>
                </div>
              </div>
              <div class="row player-play-area panel-body">
                <div id="{{ player_name }}-cards" class="player-cards h-100 col-12"></div>
              </div>
            </div>
          </div>
       </div>

    <!-- Start menu -->
    <div class="modal fade" id="start-menu" tabindex="-1" role="dialog" aria-labelledby="start-menu-label" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Start game</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="winning-score"><span class="glyphicon glyphicon-eye-open"></span> Winning score</label>
              <input type="text" class="form-control" id="winning-score" value="121">
            </div>
            <div class="checkbox">
              <label><input id="play-with-jokers" type="checkbox" value=""> Play with jokers</label>
            </div>
            <button id="start-game" class="btn btn-default btn-primary btn-block"><span class="glyphicon glyphicon-off"></span>Start</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Joker selection -->
    <div class="modal fade" id="joker-selector" tabindex="-1" role="dialog" aria-labelledby="joker-selector-label" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="jokerSelectorLabel">You got a joker!</h5>
          </div>
          <div class="modal-body">
            <div class="card-selector-ranks-row">
              <span class="joker-rank-selection" data-value="Ace">A</span>
              <span class="joker-rank-selection" data-value="Two">2</span>
              <span class="joker-rank-selection" data-value="Three">3</span>
              <span class="joker-rank-selection" data-value="Four">4</span>
              <span class="joker-rank-selection" data-value="Five">5</span>
              <span class="joker-rank-selection" data-value="Six">6</span>
              <span class="joker-rank-selection" data-value="Seven">7</span>
              <span class="joker-rank-selection" data-value="Eight">8</span>
              <span class="joker-rank-selection" data-value="Nine">9</span>
              <span class="joker-rank-selection" data-value="Ten">10</span>
              <span class="joker-rank-selection" data-value="Jack">J</span>
              <span class="joker-rank-selection" data-value="Queen">Q</span>
              <span class="joker-rank-selection" data-value="King">K</span>
            </div>
            <div class="card-selector-suits-row">
              <img class="joker-suit-selection" data-value="hearts" src="/static/img/cards/hearts" />
              <img class="joker-suit-selection" data-value="spades" src="/static/img/cards/spades" />
              <img class="joker-suit-selection" data-value="diamonds" src="/static/img/cards/diamonds" />
              <img class="joker-suit-selection" data-value="clubs" src="/static/img/cards/clubs" />
            </div>
            <button id="select-joker" class="btn btn-default btn-primary btn-block"><span class="glyphicon glyphicon-off"></span>Select</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      function displayDesktop() {
        let gameLogContainer = $('.game-log-container');
        let gamePlayContainer = $('.game-play-container');
        let game = $('.game');
        game.prepend(gameLogContainer);
        gameLogContainer.removeClass('col-9').addClass('col-3');
        gamePlayContainer.removeClass('col-12').addClass('col-9');
        $('.game-log-header').show();
        $('.peg-board').show();
        $('.player').addClass('desktop');
        $('.game-log').css('height', '85%');
      }

      function displayMobile() {
        let gamePlayContainer = $('.game-play-container');
        let gameLogContainer = $('.game-log-container');
        let middleArea = $('.middle-area');
        middleArea.prepend(gameLogContainer);
        gameLogContainer.removeClass('col-3').addClass('col-9');
        gamePlayContainer.removeClass('col-9').addClass('col-12');
        $('.game-log-header').hide();
        $('.peg-board').hide();
        $('.player').removeClass('desktop');
        $('.game-log').css('height', '80%');
      }

      $(document).ready(function() {
        if ($( window ).width() >= 768) {
          displayDesktop();
        }
        $('#select-joker').prop('disabled', true);
      });

      $(window).on('resize', function() {
        if($(document.activeElement).attr('type') === 'text') {
          // ignore resizes if keyboard is active
        } else {
         if ($( window ).width() >= 768) {
           displayDesktop()
         } else {
           displayMobile()
         }
        }
      });
    </script>
  </body>
</html>